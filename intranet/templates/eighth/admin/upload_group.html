{% extends "eighth/admin/eighth_admin_page_base.html" %}

{% block css %}
    {{ block.super }}
    <style type="text/css">
textarea[name=filetext] {
    width: 500px;
    height: 200px;
}
    </style>
{% endblock %}

{% block admin_main %}

{% if stage == "upload" %}
    <p style="width: 500px">Either upload a file or enter text in the box below containing either Student IDs (e.x. 1231234), Ion IDs (31863), or TJ usernames (2016jwoglom), separated by line breaks.</p>
    <form action="" method="post" autocomplete="off" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="file"><b>Upload File:</b></label>
        <br /><br />
        {{ form.file }}
        <br /><br />
        <input type="submit" value="Upload" />
    </form>
    <br />
    <hr />
    <br />
    <form action="" method="post" autocomplete="off" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="filetext"><b>Enter text:</b></label><br />
        <textarea name="filetext"></textarea>
        <br />
        <input type="submit" value="Read Data" />
    </form>

{% elif stage == "parse" %}
<p>Check the boxes for the users you wish to import.</p>
    <b>Matched users:</b>
    <form action="" method="post">
    {% csrf_token %}
    <table class="fancy-table">
    <thead>
        <tr>
            <th>Input line</th>
            <th></th>
            <th>User Matched</th>
        </tr>
    </thead>
    <tbody>
    {% for user in sure_users %}
        <tr>
            <td>{{ user.0 }}</td>
            <td>
                <input type="checkbox" name="user_id" value="{{ user.1.id }}" checked /> 
            </td>
            <td>
                {{ user.1.display_name }} ({{ user.1.student_id }}, {{ user.1.grade }})
            </td>
        </tr>
    {% empty %}
        No valid user identifiers were found.
    {% endfor %}
    </tbody>
    </table>
    <input type="submit" value="Add Users" />
    <br /><br />
    <b>Unmatched users:</b>
    <table class="fancy-table">
    <thead>
        <tr>
            <th>Input line</th>
            <th></th>
            <th>User Matched</th>
        </tr>
    </thead>
    <tbody>
    {% for user in unsure_users %}
        <tr>
            <th>{{ user.0 }}</th>
            {% if user.1 %}
                {% for u in user.1 %}
                <td>
                    <input type="checkbox" name="add_user" value="{{ u.id }}" /> 
                </td>
                <td>
                    {{ u.display_name }} ({{ u.student_id }}, {{ u.grade }})
                </td>
                {% endfor %}
            {% else %}
                <td></td>
                <td>No matches found.</td>
            {% endif %}
            </td>
        </tr>
    {% empty %}
        <tr>
            <th colspan="3">All users were properly matched.</th>
        </tr>
    {% endfor %}
    </tbody>
    </table>
    </form>
{% endif %}

{% endblock %}
