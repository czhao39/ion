{% extends "eighth/admin/eighth_admin_page_base.html" %}

{% block css %}
    {{ block.super }}
    <style type="text/css">
textarea[name=filetext] {
    width: 500px;
    height: 300px;
}
    </style>
{% endblock %}

{% block admin_main %}

{% if stage == "upload" %}
    <form action="" method="post" autocomplete="off" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="file">File:</label> &nbsp; 
        {{ form.file }}<br />
        <input type="submit" value="Upload File" />
    </form>
    <br />
    <hr />
    <br />
    <form action="" method="post" autocomplete="off" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="filetext">Enter Text:</label><br />
        <textarea name="filetext"></textarea>
        <br />
        <input type="submit" value="Read Data" />
    </form>

{% elif stage == "parse" %}
    <b>Matched users:</b>
    <form action="" method="post">
    {% csrf_token %}
    <table class="fancy-table">
    <thead>
        <tr>
            <th>Input line</th>
            <th><input type="checkbox" /></th>
            <th>User Matched</th>
        </tr>
    </thead>
    <tbody>
    {% for user in sure_users %}
        <tr>
            <td>{{ user.0 }}</td>
            <td>
                <input type="checkbox" name="user_id" value="{{ user.1.id }}" /> 
            </td>
            <td>
                {{ user.1.display_name }} ({{ user.1.student_id }}, {{ user.1.grade }})
            </td>
        </tr>
    {% endfor %}
    </tbody>
    </table>
    <input type="submit" value="Add Users" />
    <br /><br />
    <b>Unmatched users:</b>
    <table class="fancy-table">
    <thead>
        <tr>
            <th>Input line</th>
            <th></th>
            <th>User Matched</th>
        </tr>
    </thead>
    <tbody>
    {% for user in unsure_users %}
        <tr>
            <th>{{ user.0 }}</th>
            <td>
            {% if user.1 %}
                {% for u in user.1 %}
                    <input type="checkbox" name="add_user" value="{{ u.id }}" /> 
                    {{ u.display_name }} ({{ u.student_id }}, {{ u.grade }})
                    <br />
                {% endfor %}
            {% else %}
                No possible matches found.
            {% endif %}
            </td>
        </tr>
    {% empty %}
        <tr>
            <th colspan="3">All users were properly matched.</th>
        </tr>
    {% endfor %}
    </tbody>
    </table>
    </form>
{% endif %}

{% endblock %}
