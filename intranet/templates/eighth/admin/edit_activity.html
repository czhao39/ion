{% extends "eighth/admin/eighth_admin_page_base.html" %}

{% block js %}
    {{ block.super }}
    <script type="text/javascript">
    $(function() {
        addGroup = function() {
            $("#submit_button").attr("name", "add_group").click();
        }

        $("#activity-select").on("change", function() {
            var v = $(this).val();
            if(v && v.length > 0) {
                location.href = './' + v;
            }
        });
    });
    </script>
{% endblock %}

{% block css %}
    {{ block.super }}
    <style type="text/css">
.select-area .selectize-control {
    max-width: 455px;
}

.edit-table .selectize-control {
    width: 300px;
}

.restriction-list {
    position: absolute;
    top: 100px;
    right: 10px;
    width: 500px;
}

@media (max-width: 1092px) {
    .restriction-list {
        width: 400px;
    }
}

@media (max-width: 992px) {
    .restriction-list {
        width: 300px;
    }
}

@media (max-width: 892px) {
    .restriction-list {
        position: static;
        width: auto;
    }
}

@media (max-width: 582px) {
    .select-area .selectize-control {
        width: 100%;
    }
}

@media (max-width: 468px) {
    .select-area .selectize-control {
        width: 416px;
    }
}

    </style>
{% endblock %}

{% block admin_main %}
        <h4>Select an Activity:</h4>

        <div class="select-area">
            <select id="activity-select" placeholder="Select or search for an activity" autocomplete="off">
                <option value="">Select or search for an activity</option>
                {% for a in activities %}
                    <option value="{{ a.id }}"{% if a == activity %} selected{% endif %}>{{ a.aid }}: {{ a.name_with_flags }}</option>
                {% endfor %}
            </select>
        </div>

        <div>
                <a href="" class="button">
                    Edit Activity
                </a>
                <a href="{% url 'eighth_admin_schedule_activity' %}?activity={{ activity.id }}" class="button">
                    Schedule Activity
                </a>
        </div>
        <br />

<form action="" method="post" autocomplete="off" name="edit_form">
    <table class="edit-table">
        {% csrf_token %}
        {{ form.as_table }}
        <tr>
            <td class="right-buttons" colspan=2>
                <a class="button" href="{% url 'eighth_admin_dashboard' %}">Cancel</a>
                {% if delete_url %}
                    <a class="button" href="{{ delete_url }}">Delete</a>
                {% endif %}
                <input type="submit" value="Save" id="submit_button" />
            </td>
        </tr>
    </table>
</form>

<div class="restriction-list">
    <h2>Restriction List:</h2>
    {% if activity.administrative %}
        This activity is Administrative, so it will not appear in users' signup lists.<br />
    {% endif %}
    {% if activity.restricted %}
        {% if not activity.groups_allowed.all and not activity.users_allowed.all and not activity.freshmen_allowed and not activity.sophomores_allowed and not activity.juniors_allowed and not activity.seniors_allowed %}
            This activity is restricted. No students may sign up for this activity.
        {% else %}
            This activity is restricted to the following members:
            <ul>
                {% if activity.freshmen_allowed %}
                    <li><b>All Freshmen</b></li>
                {% endif %}
                {% if activity.sophomores_allowed %}
                    <li><b>All Sophomores</b></li>
                {% endif %}
                {% if activity.juniors_allowed %}
                    <li><b>All Juniors</b></li>
                {% endif %}
                {% if activity.seniors_allowed %}
                    <li><b>All Seniors</b></li>
                {% endif %}

                {% for group in activity.groups_allowed.all %}
                    <li><b>Group: {{ group }}</b> (<a href="{% url 'eighth_admin_edit_group' group.id %}">Modify</a>)
                    <ul>
                        {% if group.user_set.count < 50 %}
                            {% for member in group.user_set.all %}
                                <li>{{ member.last_name }}, {{ member.first_name }} ({{ member }})</li>
                            {% endfor %}
                        {% else %}
                            <li>Over 50 members, user list not shown</li>
                        {% endif %}
                    </ul>
                    </li>
                {% endfor %}

                {% for member in activity.users_allowed.all %}
                    <li>{{ member.last_name }}, {{ member.first_name }} ({{ member }})</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% else %}
        This activity is not restricted. All students may sign up for this activity.<br />
        <button onclick="addGroup()">Add and Assign Empty Group</button>
    {% endif %}

</div>
{% endblock %}
