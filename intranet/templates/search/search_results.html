{% extends "page_with_nav.html" %}
{% load staticfiles %}

{% block title %}
    {{ block.super}} - Search{% if search_query %} - {{ search_query }}{% endif %}
{% endblock %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static 'css/search.css' %}">
{% endblock %}


{% block main %}
<div class="primary-content">
    <h2>Search Results</h2>
    <form class="search" action="{% url 'search' %}" method="get" autocomplete="off">
            <input type="text" name="q" value="{{ search_query }}">
            <button type="submit">
               <i class="fa fa-search"></i>
            </button>
    </form>
    <br>
    {% if search_results %}
        {{ search_results|length }} result{{ search_results|pluralize }}
        <ul>
            {% for user in search_results %}
                <li>
                    <a href="{% url 'user_profile' user.ion_id %}">
                        {% if user.fullname %}{{ user.fullname }}{% else %}{{ user.firstname }} {{ user.lastname }}{% endif %} ({% if user.gradyear %}{{ user.gradyear }}{% else %}Staff{% endif %})
                    </a>
                </li>
            {% endfor %}
        </ul>
    {% elif search_query %}
        <b>No results.</b>
    {% endif %}
    {% if query_error %}
        <br>
        There was an error in your query syntax.
        <br>
        <br>
    {% endif %}


    {% if "tips" in request.GET or query_error or not search_query %}
        <h3>Advanced Search Tips</h3>
        <p>
            <b>Operators</b>
            <table>
                <tr>
                    <td><em>&amp;&amp;</em></td>
                    <td>signifies AND operation</td>
                </tr>
                <tr>
                    <td><em>||</em></td>
                    <td>signifies OR operation</td>
                </tr>
                <tr>
                    <td><em>!</em></td>
                    <td>negates a single expression</td>
                </tr>
                <tr>
                    <td><em>+</em></td>
                    <td>indicates a term must be present</td>
                </tr>
                <tr>
                    <td><em>-</em></td>
                    <td>indicates a term must not be present</td>
                </tr>
                <tr>
                    <td><em>"..."</em></td>
                    <td>wraps a number of tokens to signify a phrase for searching (e.g. <em>"my search"</em>)</td>
                </tr>
                <tr>
                    <td><em>(...)</em></td>
                    <td>signifies precedence</td>
                </tr>
                <tr>
                    <td><em>~N</em></td>
                    <td>after a word signifies edit distance (fuzziness)</td>
                </tr>
                <tr>
                    <td><em>~N</em></td>
                    <td>after a phrase signifies slop amount</td>
                </tr>
                <tr>
                    <td><em>/.../</em></td>
                    <td>indicates a regular expression is enclosed between the slashes (leading wildcards not allowed)</td>
                </tr>
                <tr>
                    <td><em>[... TO ...]</em></td>
                    <td>indicates a range of numbers (e.g. <em>[2015 TO 2017]</em>)</td>
                </tr>
            </table>
        </p>
        <p>
            <b>Searchable Fields</b>
            <ul>
                <li><em>name</em></li>
                <li><em>firstname</em></li>
                <li><em>lastname</em></li>
                <li><em>middlename</em></li>
                <li><em>nickname</em></li>
                <li><em>id</em> (e.g. 31863)</li>
                <li><em>username</em> (e.g. 2015elowman)</li>
                <li><em>gradyear</em> (e.g. 2015)</li>
                <li><em>sex</em></li>
            </ul>
        </p>
        <p>
            <b>Examples</b>
            <ul>
                <li>
                    To find all members of the class of 2015:
                    <br>
                    <em class="search-example">gradyear:2015</em>
                </li>
                <li>
                    To find all females:
                    <br>
                    <em class="search-example">sex:female</em>
                </li>
                <li>
                    To find all males in the class of 2015:
                    <br>
                    <em class="search-example">gradyear:2015 &amp;&amp; sex:male</em>
                </li>
                <li>
                    To find all people without an "e" in their last name but not in their first name who graduate between 2015 and 2017:
                    <br>
                    <em class="search-example">firstname:/[^e]+/ &amp;&amp; !(lastname:/[^e]+/) &amp;&amp; gradyear:[2015 TO 2017]</em>
                </li>
                <li>
                    To find people with username collisions:
                    <br>
                    <em class="search-example">username:/[0-9]{4}[a-z]+[0-9]/</em>
                </li>
            </ul>
        </p>

    {% else %}
        <br><br>
        <a href="{% url 'search' %}?tips">Advanced Search Tips</a>
    {% endif %}
</div>
{% endblock %}
